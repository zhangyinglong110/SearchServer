
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<script type="text/javascript" src="js/AjaxRequest.js"></script>
<script type="text/javascript" src="js/WdatePicker.js"></script>
<script type="text/javascript" src="js/zepto.min.js"></script>
<link rel="stylesheet" href="css/select.css" />
<link rel="stylesheet" href="css/selectindex.css" />
<script type="text/javascript">
	function getLargeArea() {
		var loader = new net.AjaxRequest(
			"zoneServlet?action=getLargeArea&nocache="
			+ new Date().getTime(), deal_getLargeArea, onerror,
			"GET");
	}

	function deal_getLargeArea() {
		largeAreaArr = this.req.responseText.split(","); //将获取的省份名称字符串分割为数组
		for (i = 0; i < largeAreaArr.length; i++) {
			document.getElementById("large_Area").options[i] = new Option(
				largeAreaArr[i], largeAreaArr[i]);
		}
		if (largeAreaArr[0] != "") {
			getSchName(largeAreaArr[0]);
		}
	}

	window.onload = function() {
		getLargeArea();

	}

	function getSchName(selLargeArea) {
		var loader = new net.AjaxRequest(
			"zoneServlet?action=getSchName&parLargeArea=" + selLargeArea
			+ "&nocache=" + new Date().getTime(), deal_getSchName,
			onerror, "GET");
	}

	function deal_getSchName() {
		schNameAarr = this.req.responseText.split(",");
		document.getElementById("sch_Name").length = 0;
		for (i = 0; i < schNameAarr.length; i++) {
			document.getElementById("sch_Name").options[i] = new Option(schNameAarr[i],
				schNameAarr[i]);
		}
	}

	function getSelectInfo(url) {
		var loader = new net.AjaxRequest(url, deal_getSchName, onerror, "GET");
	}


	function onerror() {
		alert("出错了!");
	}
</script>
<title>查询页面</title>
</head>
<!--头部-->
<div class="headerContainer">
	<header class="innerContainer header"> <img
		src="images/logo.jpg" alt="翡翠教育logo" /> </header>
</div>
<!--表单-->
<div class="main">
	<div class="contentContainer">
		<h1 class="title">请选择查询条件：</h1>
		<form method="post" name="form2" id="form2">
			<div class="upContainer">
				<div class="row left">
					<span class="ChoiceText"><strong>大</strong>区：</span> <select
						name="large_Area" id="large_Area"
						onChange="getSchName(this.value)"></select>
				</div>
				<div class="row left">
					<span class="ChoiceText"><strong>校</strong>区：</span> <select
						name="sch_Name" id="sch_Name"></select>
				</div>
				<div class="row left">
					<span class="choiceText"><strong>专</strong>业：</span> <select
						name="major" id="major">
						<option>请选择</option>
						<option>UI设计</option>
						<option>web前端</option>
						<option>Android</option>
						<option>网络营销</option>
						<option>java</option>
						<option>php</option>
						<option>游戏美术</option>
						<option>游戏程序</option>
					</select>
				</div>

				<div class="row left">
					<span class="choiceText"><strong>角</strong>色：</span> <select
						name="teacherrole" id="teacherrole">
						<option>讲师</option>
						<option>班主任</option>
						<option>就业</option>
					</select>
				</div>

				<div class="row left">
					<span class="choicetxt">起始日期：</span> <input class="Wdate"
						type="text" onclick="WdatePicker()" id="startDate"
						name="startDate"><br>
				</div>
				<div class="row left">
					<span class="choiceTxt">结束日期：</span> <input class="Wdate"
						type="text" onclick="WdatePicker()" id="endDate" name="endDate"><br>
				</div>
			</div>
			<div class="btnContainer">
				<button type="button" class="btn1 searchBtn" value="查询" name="查询"
					onclick="chaxun(form2)">查询</button>
				<button type="button" class=" outPutBtn" value="导出" id="exportss"
					onclick="exportssTab(form2)" style="visibility: hidden;">导出明细</button>
			</div>
			<p
				style="color: #FF0000; font-size:16px; text-align: right;padding-bottom:5px">使用过程中如有问题，请邮件反馈至&nbsp;&nbsp;yanxing@feicuiedu.com</p>
		</form>
	</div>
	<!--表格-->
	<div id="selectDiv" class="innerContainer">
		<table border="1" align="center" id="tab">
			<tr>
				<th>大区</th>
				<th>校区</th>
				<th>教师姓名</th>
				<th>角色</th>
				<th>专业</th>
				<th>班级</th>
				<th>投票人数</th>
				<th>平均分</th>
			</tr>
			<tbody id="data_body">
			</tbody>
		</table>
	</div>
</div>
<!--尾部-->
<div class="footer">
	<div class="innerContainer">
		<p class="footerText">总部地址:北京市海淀区小南庄怡秀园甲一号亿德大厦10层 电话：010-61943240</p>
		<p class="footerText">Copyright © 2005-2020 北京翡翠教育科技有限公司，All
			Rights Reserved 京ICP备12036804号-23</p>
	</div>
</div>
</body>
<script>
	function exportssTab(form2) {
		var conditionData = {
			"largeArea" : document.getElementById('large_Area').value,
			"schName" : document.getElementById('sch_Name').value,
			"cusName" : document.getElementById('major').value,
			"role" : document.getElementById('teacherrole').value,
			"startDate" : document.getElementById('startDate').value,
			"endDate" : document.getElementById('endDate').value
		};
		var url = "ExportssServlet";
		$.ajax({
			async : false,
			method : "POST",
			traditional : false,
			data : {
				name : JSON.stringify(conditionData)
			},
			url : url,
			success : function(data) {
				alert(data);
				location.href = "/SearchServer/xlsx/" + data;
				//location.href = 'http://tp.feicuiedu.com:8081/WebRoot/xlsx/'+data;
				//location.href = 'http://tp.feicuiedu.com:8081/WebRoot/xlsx/' + data;

			},
			error : function(err) {
				alert('error');
			}
		});

	}

	function chaxun(form2) {
		if (form2.startDate.value == "") { //验证用户名是否为空
			alert("请输入起始日期！");form2.startDate.focus();return false;
		}
		if (form2.endDate.value == "") { //验证密码是否为空
			alert("请输入结束日期！");form2.endDate.focus();return false;
		}
		var conditionData = {
			"largeArea" : document.getElementById('large_Area').value,
			"schName" : document.getElementById('sch_Name').value,
			"cusName" : document.getElementById('major').value,
			"role" : document.getElementById('teacherrole').value,
			"startDate" : document.getElementById('startDate').value,
			"endDate" : document.getElementById('endDate').value
		};
		var url = "selectServlet";

		$.ajax({
			async : false,
			method : "POST",
			traditional : false,
			data : {
				name : JSON.stringify(conditionData)
			},
			url : url,
			success : function(data) {
				var json = eval("(" + data + ")");
				if (json.length == 0) {
					alert("当前查询无结果！");
				} else {
					document.getElementById("exportss").style = "block";
				}

				$("#selectDiv").show();
				$("#exportss").show();
				$("#data_body").empty();
				$(json).each(function(i) {
					var $tr = $("<tr align='center'></tr>"); //表格的一行，在里面可以加各种属性;  
					var $td = $("<td></td>"); //行中的元素  
					$tr.append($td.clone().text(json[i].large_Area));
					$tr.append($td.clone().text(json[i].sch_Name));
					$tr.append($td.clone().text(json[i].tea_Name));
					$tr.append($td.clone().text(json[i].role_Level));
					$tr.append($td.clone().text(json[i].cus_Name));
					$tr.append($td.clone().text(json[i].stu_Class));
					$tr.append($td.clone().text(json[i].peopleCount));
					$tr.append($td.clone().text(json[i].average));
					$tr.appendTo($("#data_body")); //别忘了最后要把内容放入前面的tbody  
				});
			},
			error : function(err) {
				alert('error');
			}
		});
	}
</script>
</html>