(function(){
  //解决移动端click延迟事
/*
	window.addEventListener( "load", function() {
		FastClick.attach(document.body);
	}, false );
*/



	var now = { row:1, col:1 }, last = { row:0, col:0};
	const towards = { up:1, right:2, down:3, left:4};
	var isAnimating = false;

	s=window.innerHeight/500;
	ss=250*(1-s);

	$('.wrap').css('-webkit-transform','scale('+s+','+s+') translate(0px,-'+ss+'px)');

	document.addEventListener('touchmove',function(event){event.preventDefault(); },false);

	$(".page.pageCanSwipe").swipeUp(function(){
		if (isAnimating) return;
		last.row = now.row;
		last.col = now.col;
		if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}
	});

	$(".page.pageCanSwipe").swipeDown(function(){
		if (isAnimating) return;
		last.row = now.row;
		last.col = now.col;
		if (last.row!=1) { now.row = last.row-1; now.col = 1; pageMove(towards.down);}
	});

	/*$(document).swipeLeft(function(){
	 if (isAnimating) return;
	 last.row = now.row;
	 last.col = now.col;
	 if (last.row>1 && last.row<10 && last.col==1) {
	 now.row = last.row;
	 now.col = 2;
	 pageMove(towards.left);
	 }
	 });

	 $(document).swipeRight(function(){
	 if (isAnimating) return;
	 last.row = now.row;
	 last.col = now.col;
	 if (last.row>1 && last.row<10 && last.col==2) {
	 now.row = last.row;
	 now.col = 1;
	 pageMove(towards.right);
	 }
	 })
	 */
	function pageMove(tw){
		var lastPage = ".page-"+last.row+"-"+last.col;
		var nowPage = ".page-"+now.row+"-"+now.col;

		switch(tw) {
			case towards.up:
				outClass = 'pt-page-moveToTop';
				inClass = 'pt-page-moveFromBottom';
				break;
			case towards.right:
				outClass = 'pt-page-moveToRight';
				inClass = 'pt-page-moveFromLeft';
				break;
			case towards.down:
				outClass = 'pt-page-moveToBottom';
				inClass = 'pt-page-moveFromTop';
				break;
			case towards.left:
				outClass = 'pt-page-moveToLeft';
				inClass = 'pt-page-moveFromRight';
				break;
		}
		isAnimating = true;
		$(nowPage).removeClass("hide");

		$(lastPage).addClass(outClass);
		$(nowPage).addClass(inClass);

		setTimeout(function(){
			$(lastPage).removeClass('page-current');
			$(lastPage).removeClass(outClass);
			$(lastPage).addClass("hide");
			$(lastPage).find("img").addClass("hide");

			$(nowPage).addClass('page-current');
			$(nowPage).removeClass(inClass);
			$(nowPage).find("img").removeClass("hide");

			isAnimating = false;
		},600);
	}

  // 全局对象，取到所有字段的值
	var temp = {};

	//得到大区的字段
	$(".area").on('singleTap',function(){
		console.log($(this).html());
		temp.large_Area = $(this).html();
	});
	//点击大区选项进入校区选项
	var branches=[
		['北京中关村','北京国贸', '北京通州', '北京回龙观','北京艾特',
			'翡翠昌平', '天津南开','天津新安','天津南开','石家庄民族路'],
		['完美上海虹口区东江湾','卓新上海虹口区东江湾校区','上海徐汇',
			'上海珠洲口','上海浦东'],
		['完美先雁塔区小寨校区','卓新智趣西安第二分公司','西安华融',
			'西安太白','西安钟楼','太原小店','太原长风街','郑州金水','郑州国泰'],
		['长沙书院','长沙雨花','长沙中扬','武汉洪山','武汉江汉',
			'常婵红谷滩','南昌二分'],
		['济南历下','济南新','青岛南区','沈阳沈河','沈阳和平','大连中山'],
		['深圳华强北','深圳罗湖','深圳福田','广州黄埔','广州元岗',
			'广州长兴','柳州广场路','南宁西乡塘','福州台江'],
		['合肥新都会','合肥长江路','南京玄武','南京雨花台','苏州姑苏','常州钟楼',
			'无锡滨湖','杭州下城','卓新智趣杭州第二分公司','宁波***州'],
		['重庆沙坪坝','重庆天陈','重庆渝中','成都武侯','成都青羊','成都牛王庙','贵阳南明']

	];

	function schoolChoice(){
		$(".area").on("singleTap",function(){
			/*$(".fakeBox").css("display","none");*/
      $(".kuang").show(5000);
			$("#schools").css({"display":"block"});

			/*$(".page-2-1").css({"background":"#000","opacity":"0.4"});*/
			$(this).css("display","block");
			/*$(this).parents('.flex-container').css("display","none");*/

			var index=$(this).index();   //大区的下标
			var list="";
			for(var i=0;i<branches[index].length;i++){
				list+="<li>"+branches[index][i]+"</li>" ;
				$("#schools").html(list);
				$("li").on("singleTap",function(){
					$(this).siblings().css("background","");
					$(this).css("background","#fdd107");

					/*$("#schools").css("display","none");
					$(".kuang").css("display","none");*/
					$(".confirm").on("singleTap",function(){
						if (isAnimating) return;
						last.row = now.row;
						last.col = now.col;
						if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}

					});

					//得到每个校区名字
					/*alert($(this).html());*/
					var liIndex = $(this).index();
					var schoolName=$(this).html();
					temp.sch_Name = schoolName;
					/*temp.sch_Name = liIndex;*/
					console.log(temp.sch_Name);

					/*wholeDataArr = eval('('+(JSON.stringify(schoolObj)+JSON.stringify(json2)).replace(/}{/,',')+')');*/
				})
			}
		});
	}
	schoolChoice();
  /*//退回键
	$("#backTo").on("singleTap",function(){
		if($(".flex-container").css("display","block")){
			$("#schools").css("display","none");
			$(this).css("display","none");
			console.log('aaaa');
		}else{
			$("#schools").css("display","block");
			$(this).css("display","block");

		}
	});*/
	//点击学校名称页面的×号，关闭页面
	$(".modal-close-btn").on("singleTap",function(){
		$("#schools").css("display","none");
		$(".kuang").css("display","none");
	});
	//得到专业的value值
	$(".profession").on("singleTap",function(){
		$(this).siblings().css("background","");
		/*$(this).css("background","#f48268");*/
		$(this).css("background","#86fc73");

		$(".professionBtn").css("background","#52a245");
		$(".professionBtn").click(function(){
			if (isAnimating) return;
			last.row = now.row;
			last.col = now.col;
			if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}

		});
		/*alert($(this).html());*/
		temp.cus_Name = $(this).html();
		console.log($(this).html());
	});
	//得到教师的名字
	$("#uName").blur(function(){
		temp.tea_Name = $(this).val();
		console.log($(this).val())
	});

	$("#uName").bind("input propertychang",function(){
		var taValue = $("#uName").val();
		console.log(taValue);
		var len = getCharSize(taValue);
		console.log(len);
		if (len >= 4 && len <= 8) {
			$(".btn").css("background","#52a245");
		}else if(len < 4){
			$(".btn").css("background","#ccc");
		}
		$(".btn").click(function(){
			var user = $("#uName").val();
			var patten= new RegExp("^([\u4E00-\u9FA5]{2,4})$");
			if(patten.test(user)) {
				if (isAnimating) return;
				last.row = now.row;
				last.col = now.col;
				if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}
				return true;
			}else{
				$(".nameRemindWords").html("非法字符");
				$(".nextQuestion").css("background","#ccc");
				return false;
			}


		});
	});

	//得到单选按钮的选项
	/*var arr = new Array(10);
	for(var i = 0;i < 10; i++){
		arr[i] = '';
	}
	$("input[name = 'attendance']").click(function(){


		$(this).attr("checked",true)
    console.log($(this).attr("checked"));
		console.log($(this));
		var radioVal = $(this).val();
		console.log('radioVal-->'+ (typeof radioVal));
		var divVal=$(this).parents('.page').index();
		console.log('divVal-->'+typeof divVal);
		arr[(divVal-3)]=radioVal;
		console.log(arr);
		temp.sch_Name = arr[0];
		temp.cls_Explain =  arr[1];
		temp.cls_Quesions = arr[2];
		temp.ques_Answer = arr[3];
		temp.cls_Coach = arr[4];
		temp.cls_Discipline = arr[5];
		temp.cls_Skill = arr[6];
		temp.cls_Progress = arr[7];
	});*/
	//得到10个问题的数据
	$("input[name = 'attendance'] ").click(function(){
		temp.tea_Attendance = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'onClass']").click(function(){
		temp.cls_Explain = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'questions'] ").click(function(){
		temp.cls_Quesions = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'answers'] ").click(function(){
		temp.ques_Answer = $(this).val();
		console.log($(this).val());

	});
	$("input[name = 'tutorAfterClass'] ").click(function(){
		temp.cls_Coach = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'discipline'] ").click(function(){
		temp.cls_Discipline = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'skills'] ").click(function(){
		temp.cls_Skill = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'progress'] ").click(function(){
		temp.cls_Progress = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'explain'] ").click(function(){
		temp.exam_Explain = $(this).val();
		console.log($(this).val());
	});
	$("input[name = 'works'] ").click(function(){
		temp.class_Homework = $(this).val();
		console.log($(this).val());
	});


	//建议框的提示文字
	$("#suggestions").bind("input propertychang",function(){
		var taValue = $("#suggestions").val();
		temp.stu_Advice= taValue;
		/*if (len >= 20) {
			$(".lastSubmit").css("background","#52a245");
		}else if(len < 20){
			$(".lastSubmit").css("background","#ccc");
		}*/
	});
	//id的假数据
	temp.user_Id = 38496;

	//全部提交按钮，传输数据
	$(".lastSubmit").click(function(){
		if(!(temp.stu_Advice)){
			temp.stu_Advice = "";
		}
		var jslength=0;
		for(var js2 in temp){

			jslength++;

		}
		//alert(jslength);
		//向上滑动
		if (isAnimating) return;
		last.row = now.row;
		last.col = now.col;
		if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}
		console.log(jslength);
		if(true){
			console.log(temp);
			var url="http://192.168.191.1:8080/SearchServer/SaveServlet";
			$.ajax({
				async:false,
				method:"POST",
				traditional:true,
				data:{
					name:JSON.stringify(temp)
				},
				url:url,
				success:function(data){
					console.log(data);
					var bigData = JSON.parse(data);
					console.log(bigData);
					//获取标题
					var strtit =  bigData[0].cus_Name;
					var lartit =  bigData[0].large_Area;

					console.log(strtit);
					// 基于准备好的dom,初始化echarts实例
					var teacherName = [];
					var teacherScore = [];
					var teaName = [];//动态获取的老师的姓名
					var teaSc = [];//动态获取的老师的分数
					for(var i = 0;i<bigData.length;i++){
						teacherName.push(bigData[i].tea_Name);
						teacherScore.push(bigData[i].average);
					}
					for(var i = 0;i<5;i++){
						teaName.push(teacherName[i]);
						teaSc.push(teacherScore[i]);
					}
					var myChart = echarts.init(document.getElementById('main'));
					// 指定图表的配置项和数据
					var option = {
						title: {
							text: 'ECharts 入门示例'
						},
						tooltip: {},
						legend: {
							data:['分数'],
							itemWidth:20,
							backgroundColor:'#52a245'
						},
						color:['#52a245','#000', '#00f', '#f00', '#0f0'],
						xAxis: {
							data: teaName,
//                    name:"老师",
							axisLabel:{
								textStyle:{
									fontSize:14
								},
								interval:0
							}
						},
						yAxis: {
							axisLabel:{
								textStyle:{
									fontSize:15
								}
							},
							name:"平均分数",
							axisLabel:{
								textStyle:{
									fontSize:20
								},
								interval:0
							}
						},
						series: [{
							name: '销量',
							type: 'bar',
							data:teaSc
						}]
					};
					myChart.setOption(option);

					$("#bTit").html(lartit+"大区"+strtit+"排行");

				}
			});
		}else{

			/*for(var js2 in temp){
				var wordSpace = ['sch_Name','tea_Name','cus_Name','tea_Attendance',
					'cls_Explain','cls_Quesions','ques_Answer','cls_Coach',
					'class_Homework','stu_Advice'];
				for(var i=0;i<wordSpace;i++){
					wordSpace[i];
				}
				if(wordSpace[i] != js2){

				}


			}*/
		}


	});






	//表单验证
	//当失去焦点的时候，判断不能为空
	$("#uName").blur(function(){
		if($("#uName").val() == ""){
			$(".nameRemindWords").html("姓名不能为空");
		}else{
			$(".nameRemindWords").html("");
		}
		/*ckname();*/
	});
	/*function ckname(){
		var user = $("#uName").val();

		var patten= new RegExp("^([\u4E00-\u9FA5]{2,4})$");
		if(!patten.test(user)) {
			alert('输入不合法！');
			return false;
		}
		return true;
	}*/
	$("#courses").blur(function(){
		if($("#courses").val() == ""){
			$(".courseRemindWords").html("课程不能为空");
		}else{
			$(".courseRemindWords").html("");
		}

	});

	//获得字符串的字符数
	function getCharSize(str){
		var realLength = 0, len = str.length, charCode = -1;
		for (var i = 0; i < len; i++) {
			charCode = str.charCodeAt(i);
			if (charCode >= 0 && charCode <= 128) realLength += 1;
			else realLength += 2;
		}
		return realLength;
	}

	//当滑动整个表单页面的时候，判断是否为空
	$(".page-4-1").on("swipe",function(){
		if($("#uName").val() == ""){
			$(".nameRemindWords").html("姓名不能为空");
		}
		if($("#courses").val() == ""){
			$(".courseRemindWords").html("课程不能为空");
		}

	});

	//判断教师姓名这一页如果没填的，禁止滚动
  $(".page-4-1").on("swipe",function() {
		if ($("#uName").val() == "") {
			$(this).unbind();
			//alert("aaaa");
		}

	});
	////判断教师姓名这一页如果填了，开始滚动
	$("#uName").change(function(){
		$(".page-4-1").on("swipe",function(){
			//向上滑动
			if (isAnimating) return;
			last.row = now.row;
			last.col = now.col;
			if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}
		})
	});


  //单选框的name属性取出来循环
  var nameArr= ["attendance","onClass","questions","answers","tutorAfterClass",
		"discipline","skills","progress","explain","works"];
	for(var i= 0;i<nameArr.length;i++){
		var arrStr=nameArr[i];

		//点击单选框选项的时候，下一题的按钮颜色变化&& 页面滑动到下一页
		$("input[name = "+arrStr+"]").click(function(){
			$(this).parent(".pageChoice").siblings('.nextQuestion').css("background","#52a245");
			$(this).parent(".pageChoice").siblings('.nextQuestion').
				on("singleTap",
				function(){
				if (isAnimating) return;
				last.row = now.row;
				last.col = now.col;
				if (last.row != 16) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}
			});


		});
	}



  /*for(var i=5;i<11;i++){

		/!*$(".page-"+i+"-1").on("swipe",function()*!/
		$(":radio").click(function(){
			 if($([name="attendance"]).is(":checked")){
				 var nameArr =["attendance","onClass","questions","answers","tutorAfterClass",
					 "assignment"];
				 for(var j=0;j<nameArr.length;j++){
					 var nameArrStr=	nameArr[j];
					 $(".triangleIcon ").click(function(){
						 console.log(nameArrStr);
						 if (isAnimating) return;
						 last.row = now.row;
						 last.col = now.col;
						 if (last.row != 12) { now.row = last.row+1; now.col = 1; pageMove(towards.up);}

					 });
				 }
			 }else if($([name="attendance"]).not(":checked") ){

				 $(".triangleIcon").unbind();
				 //alert("aaaa");
			 }
		 });


	}*/





  //所有大区的数据
	/*var bigArea = [{
		"title":"请选择您所在的区域：",
		"nams":["京津冀","上海区","西北区","华中区","华北区","华南区","华东区","西南区"]
	}];

		$.each(bigArea,function(key,value){
			for(var i=0;i<value.nams.length;i++){
				$(".flex-container").html("<div>"+value.nams[i]+"</div>");
				console.log(value.nams[i]);
			}

		})
*/



})();


